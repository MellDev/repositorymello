<div class="chat-container">
  <!-- Chat Button -->
  <button *ngIf="!isOpen" class="chat-button" (click)="toggleChat()">
    <i class="fas fa-comments"></i>
    <span *ngIf="messagesRemaining < 3" class="chat-badge">{{ messagesRemaining }}</span>
  </button>

  <!-- Chat Window -->
  <div *ngIf="isOpen" class="chat-window" [class.minimized]="isMinimized">
    <!-- Header -->
    <div class="chat-header">
      <div class="chat-title">
        <i class="fas fa-robot"></i>
        <span>AI Assistant</span>
      </div>
      <div class="chat-actions">
        <button class="btn-icon" (click)="minimizeChat()" title="Minimizar">
          <i class="fas" [class.fa-minus]="!isMinimized" [class.fa-window-maximize]="isMinimized"></i>
        </button>
        <button class="btn-icon" (click)="closeChat()" title="Fechar">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Messages -->
    <div class="chat-messages" *ngIf="!isMinimized">
      <!-- Welcome Message -->
      <div *ngIf="messages.length === 0" class="welcome-message">
        <i class="fas fa-robot"></i>
        <p><strong>Olá! Sou o assistente virtual do Anderson.</strong></p>
        <p>Como posso ajudar você hoje?</p>
        <small>Você tem {{ messagesRemaining }} perguntas disponíveis</small>
      </div>

      <!-- Message History -->
      <div *ngFor="let msg of messages" class="message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
        <div class="message-avatar">
          <i class="fas" [class.fa-user]="msg.role === 'user'" [class.fa-robot]="msg.role === 'assistant'"></i>
        </div>
        <div class="message-content">
          {{ msg.content }}
        </div>
      </div>

      <!-- Typing Indicator -->
      <div *ngIf="isTyping" class="message assistant">
        <div class="message-avatar">
          <i class="fas fa-robot"></i>
        </div>
        <div class="message-content typing">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>

      <!-- Limit Warning -->
      <div *ngIf="limitReached" class="limit-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <p><strong>Limite de mensagens atingido</strong></p>
        <p>Você atingiu o limite de {{ 3 - messagesRemaining }} mensagens.</p>
        <button class="btn-send" (click)="resetSession()">
          <i class="fas fa-redo"></i> Nova Sessão
        </button>
      </div>
    </div>

    <!-- Input -->
    <div class="chat-input" *ngIf="!isMinimized">
      <div class="messages-counter">
        <i class="fas fa-info-circle"></i>
        Mensagens restantes: {{ messagesRemaining }}/3
      </div>
      <div class="input-group">
        <input
          type="text"
          [(ngModel)]="message"
          (keyup.enter)="sendMessage()"
          placeholder="Digite sua mensagem..."
          [disabled]="limitReached || isTyping"
        />
        <button
          class="btn-send"
          (click)="sendMessage()"
          [disabled]="!message.trim() || limitReached || isTyping"
        >
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>
